<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OmniView</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css"
    />
    <link rel="stylesheet" href="monitoring.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-rotatedmarker@0.2.0/leaflet.rotatedMarker.js"></script>
  </head>
  <body>
    <!-- Main Container -->
    <div class="main-container">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="sidebar-header">
          <div class="sidebar-title-container">
            <div class="sidebar-title active-screen" id="sidebarTitle">
              MONITORING
            </div>
            <div class="dropdown-arrow">‚ñº</div>
          </div>
          <div class="screen-dropdown" id="screenDropdown">
            <div class="dropdown-item active" data-screen="monitoring">
              <div class="dropdown-icon">üìä</div>
              <span>MONITORING</span>
            </div>
            <div class="dropdown-item" data-screen="disaster">
              <div class="dropdown-icon">‚ö†Ô∏è</div>
              <span>DISASTER</span>
            </div>
            <div class="dropdown-item" data-screen="analytics">
              <div class="dropdown-icon">üìà</div>
              <span>ANALYTICS</span>
            </div>
          </div>
        </div>

        <div class="monitoring-section">
          <div class="monitoring-item active">
            <div class="item-icon">üè¢</div>
            <span>Buildings</span>
          </div>
          <div class="monitoring-item">
            <div class="item-icon">üõ£Ô∏è</div>
            <span>Roads</span>
          </div>
          <div class="monitoring-item">
            <div class="item-icon">üíß</div>
            <span>Water Bodies</span>
          </div>
          <div class="monitoring-item">
            <div class="item-icon">üö¢</div>
            <span>Ships</span>
          </div>
          <div class="monitoring-item">
            <div class="item-icon">‚úàÔ∏è</div>
            <span>Aircraft's</span>
          </div>
        </div>

        <button class="analyze-btn">Analyze</button>
      </div>

      <!-- Map Container -->
      <div class="map-container">
        <!-- Map Tools -->
        <div class="map-tools">
          <button class="tool-btn">‚úèÔ∏è</button>
          <button class="tool-btn">‚¨ú</button>
          <button class="tool-btn">‚úã</button>
          <button class="tool-btn">üìè</button>
        </div>

        <!-- Search -->
        <div class="search-container">
          <input type="text" class="search-input" placeholder="Search" />
          <div class="search-icon">üîç</div>
        </div>

        <!-- Layer Switch Buttons -->
        <div class="map-layer-controls">
          <button id="defaultLayerBtn" class="layer-btn active">Default</button>
          <button id="satelliteLayerBtn" class="layer-btn">Satellite</button>
        </div>

        <!-- Map -->
        <div id="map"></div>

        <!-- Building Change Detection Panel -->
        <div id="buildingPanel" class="content-panel" style="display: none;">
          <div class="panel-content">
            <div class="panel-header">
              <h3>üè¢ Built-up Change Detection</h3>
              <button id="closeBuildingPanel" class="close-panel-btn">√ó</button>
            </div>
            
            <div class="upload-section">
              <div class="upload-row">
                <div class="upload-column">
                  <label class="upload-label">Pre-Disaster Image</label>
                  <div class="upload-area" id="preImageUpload">
                    <div class="upload-placeholder">
                      <div class="upload-icon">üìÅ</div>
                      <div class="upload-text">Click to upload or drag & drop</div>
                      <div class="upload-hint">Supported: JPG, PNG, TIFF</div>
                    </div>
                    <input type="file" id="preImageInput" accept="image/*" style="display: none;">
                    <img id="preImagePreview" class="image-preview" style="display: none;">
                  </div>
                </div>
                
                <div class="upload-column">
                  <label class="upload-label">Post-Disaster Image</label>
                  <div class="upload-area" id="postImageUpload">
                    <div class="upload-placeholder">
                      <div class="upload-icon">üìÅ</div>
                      <div class="upload-text">Click to upload or drag & drop</div>
                      <div class="upload-hint">Supported: JPG, PNG, TIFF</div>
                    </div>
                    <input type="file" id="postImageInput" accept="image/*" style="display: none;">
                    <img id="postImagePreview" class="image-preview" style="display: none;">
                  </div>
                </div>
              </div>
              
              <div class="analysis-controls">
                <button id="runAnalysisBtn" class="analyze-btn" disabled>
                  <span class="btn-text">Run Change Detection</span>
                  <span class="btn-loader" style="display: none;">‚è≥ Processing...</span>
                </button>
                <button id="resetAnalysisBtn" class="reset-btn">Reset</button>
              </div>
            </div>
            
            <div id="resultsSection" class="results-section" style="display: none;">
              <div class="results-header">
                <h4>üîç Analysis Results</h4>
              </div>
              
              <div class="results-stats">
                <div class="stat-card">
                  <div class="stat-label">Change Detected</div>
                  <div id="changePercentage" class="stat-value">0%</div>
                </div>
                <div class="stat-card">
                  <div class="stat-label">Changed Pixels</div>
                  <div id="changedPixels" class="stat-value">0</div>
                </div>
                <div class="stat-card">
                  <div class="stat-label">Total Area</div>
                  <div id="totalPixels" class="stat-value">0</div>
                </div>
              </div>
              
              <div class="results-images">
                <div class="result-image-card">
                  <h5>Change Mask</h5>
                  <img id="maskImage" class="result-image" alt="Change detection mask">
                </div>
                <div class="result-image-card">
                  <h5>Comparison View</h5>
                  <img id="comparisonImage" class="result-image" alt="Comparison view">
                </div>
                <div class="result-image-card">
                  <h5>Overlay View</h5>
                  <img id="overlayImage" class="result-image" alt="Overlay view">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Coordinates -->
        <div class="coordinates" id="coordinates">--- ---¬∞ N, --- ---¬∞ E</div>

        <!-- Bottom Panel -->
        <div class="bottom-panel">
          <div class="panel-header">
            <div class="panel-title">Logs</div>
            <button class="expand-btn">Expand ‚ñ≤</button>
          </div>
          <div class="logs-content">
            <div class="log-warning">Warning: No area slected for analysis</div>
            <div class="log-warning">
              <!-- Warning: Can't fetch data for selected area -->
            </div>
            <div class="log-error">
              Error: Can't fetch data for selected area
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Closing tag for main-container -->
    <script src="../config.js"></script>
    <script src="monitoring.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
      // Add this logging system after the map initialization
      class Logger {
        constructor() {
          this.logs = [];
          this.logContainer = document.querySelector(".logs-content");
          this.maxLogs = 50; // Keep only last 50 logs
          this.speechEnabled = true;
          this.speechSynth = window.speechSynthesis;
        }

        speak(text) {
          if (!this.speechEnabled) return;

          // Cancel any ongoing speech
          this.speechSynth.cancel();

          const utterance = new SpeechSynthesisUtterance(text);
          utterance.rate = 0.9;
          utterance.pitch = 1;
          this.speechSynth.speak(utterance);
        }

        toggleSpeech() {
          this.speechEnabled = !this.speechEnabled;
          if (!this.speechEnabled) {
            this.speechSynth.cancel(); // Stop any ongoing speech
          }
        }

        log(message, type = "info") {
          const timestamp = new Date().toLocaleTimeString();
          const logEntry = {
            timestamp,
            message,
            type,
          };

          this.logs.unshift(logEntry);

          // Keep only recent logs
          if (this.logs.length > this.maxLogs) {
            this.logs = this.logs.slice(0, this.maxLogs);
          }

          this.updateDisplay();
          this.speak(message); // Speak new log messages
        }

        info(message) {
          this.log(message, "info");
        }

        warning(message) {
          this.log(message, "warning");
        }

        error(message) {
          this.log(message, "error");
        }

        success(message) {
          this.log(message, "success");
        }

        clear() {
          this.logs = [];
          this.updateDisplay();
        }

        updateDisplay() {
          this.logContainer.innerHTML = "";

          if (this.logs.length === 0) {
            this.logContainer.innerHTML =
              '<div class="log-info">No logs available</div>';
            return;
          }

          this.logs.forEach((log) => {
            const logDiv = document.createElement("div");
            logDiv.className = `log-${log.type}`;
            logDiv.innerHTML = `<span class="log-timestamp">[${log.timestamp}]</span> ${log.message}`;
            this.logContainer.appendChild(logDiv);
          });
        }
      }

      // Initialize logger
      const logger = new Logger();

      // Initial log
      logger.info("Application started");
      logger.warning("No area selected for analysis");

      // === Base Layers ===
      const defaultLayer = L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        { attribution: "¬© OpenStreetMap contributors", noWrap: true }
      );

      const satelliteLayer = L.tileLayer(
        "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
        { attribution: "Tiles ¬© Esri" }
      );

      // === Map Initialization ===
      const map = L.map("map", {
        center: [20.5937, 78.9629],
        zoom: 5,
        layers: [defaultLayer], // Default layer on load
        minZoom: 3,
        maxZoom: 18,
        maxBounds: [
          [-90, -180],
          [90, 180],
        ],
        maxBoundsViscosity: 1.0,
      });

      // === Feature Layers ===
      const featureLayers = {
        buildings: L.layerGroup().addTo(map),
        roads: L.layerGroup().addTo(map),
        water: L.layerGroup().addTo(map),
        ships: L.layerGroup().addTo(map),
        aircraft: L.layerGroup().addTo(map),
      };

      // Track active features
      let activeFeature = "buildings";
      let areaSelectMode = false;
      let areaRectangle = null;
      let selectedBounds = null;

      // === Markers ===
      const cities = [{ name: "Pune", coords: [18.5204, 73.8567] }];
      cities.forEach((city) => {
        L.marker(city.coords).addTo(map).bindPopup(city.name);
      });

      // Update coordinates on mouse move
      map.on("mousemove", function (e) {
        document.getElementById("coordinates").textContent =
          `${e.latlng.lat.toFixed(4)}¬∞ N, ${e.latlng.lng.toFixed(4)}¬∞ E`;
      });

      // Sidebar interactions
      document.querySelectorAll(".monitoring-item").forEach((item, index) => {
        item.addEventListener("click", function () {
          // Remove active class from all items
          document
            .querySelectorAll(".monitoring-item")
            .forEach((i) => i.classList.remove("active"));
          this.classList.add("active");

          const featureName = this.querySelector("span").textContent;
          logger.info(`Switched to ${featureName} monitoring`);

          // Clear all layers and stop any running processes
          Object.values(featureLayers).forEach((layer) => layer.clearLayers());
          if (updateFlightsInterval) {
            clearInterval(updateFlightsInterval);
            updateFlightsInterval = null;
          }

          // Reset area selection mode
          areaSelectMode = false;
          if (areaRectangle) {
            map.removeLayer(areaRectangle);
            areaRectangle = null;
          }
          map.getContainer().style.cursor = "";

          // Handle specific feature activation
          switch (index) {
            case 0: // Buildings
              activeFeature = "buildings";
              logger.info("Buildings monitoring activated");
              // Show building change detection panel
              if (buildingChangeDetection) {
                buildingChangeDetection.showBuildingPanel();
              }
              break;

            case 1: // Roads
              activeFeature = "roads";
              areaSelectMode = true;
              map.getContainer().style.cursor = "crosshair";
              logger.info(
                "Road extraction mode enabled - click on map to select area"
              );
              break;

            case 2: // Water Bodies
              activeFeature = "water";
              logger.info("Water bodies monitoring activated");
              break;

            case 3: // Ships
              activeFeature = "ships";
              logger.info("Ships monitoring activated");
              break;

            case 4: // Aircraft
              activeFeature = "aircraft";
              logger.info("Aircraft tracking activated");
              // Clear any existing interval
              if (updateFlightsInterval) {
                clearInterval(updateFlightsInterval);
              }
              // Start fresh tracking
              updateFlights();
              updateFlightsInterval = setInterval(updateFlights, 30000);
              break;
          }
        });
      });

      // Search functionality
      document
        .querySelector(".search-input")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            const query = this.value;
            console.log("Search for:", query);
          }
        });

      // Analyze button
      document.querySelector(".analyze-btn").addEventListener("click", () => {
        console.log("Starting analysis...");
      });

      // Expand logs
      document
        .querySelector(".expand-btn")
        .addEventListener("click", function () {
          const panel = document.querySelector(".bottom-panel");
          if (panel.style.height === "300px") {
            panel.style.height = "120px";
            this.textContent = "Expand ‚ñ≤";
          } else {
            panel.style.height = "300px";
            this.textContent = "Collapse ‚ñº";
          }
        });

      function getSquareBounds(center, sizeMeters = 500) {
        const halfSizeLat = sizeMeters / 2 / 111000; // Convert meters to degrees (approximately)
        const halfSizeLng =
          sizeMeters / 2 / (111000 * Math.cos((center.lat * Math.PI) / 180));
        return [
          [center.lat - halfSizeLat, center.lng - halfSizeLng],
          [center.lat + halfSizeLat, center.lng + halfSizeLng],
        ];
      }

      document
        .querySelectorAll(".monitoring-item")[1]
        .addEventListener("click", () => {
          // Enable area selection for roads tab
          areaSelectMode = true;
          map.getContainer().style.cursor = "crosshair";
          alert(
            "Click on the map to select the center of a 1km x 1km area for road extraction."
          );
        });

      // Replace the existing map click handler
      map.on("click", function (e) {
        if (!areaSelectMode) return;

        logger.info(
          `Area selected at coordinates: ${e.latlng.lat.toFixed(4)}¬∞N, ${e.latlng.lng.toFixed(4)}¬∞E`
        );

        if (areaRectangle) {
          featureLayers.roads.removeLayer(areaRectangle);
          areaRectangle = null;
        }

        // Remove existing control if present
        const existingControl = document.querySelector(".area-control");
        if (existingControl) {
          existingControl.remove();
        }

        // Initial bounds with 500m default
        const bounds = getSquareBounds(e.latlng, 500);
        selectedBounds = bounds;
        areaRectangle = L.rectangle(bounds, {
          color: "#00a8e8",
          weight: 2,
        }).addTo(featureLayers.roads);

        // Create custom control
        const controlDiv = document.createElement("div");
        controlDiv.className = "area-control";
        controlDiv.innerHTML = `
          <b>Area Selected</b><br>
          <div style="margin-bottom: 10px;">
            <label for="areaSize">Area Size (meters):</label>
            <input type="number" id="areaSize" value="500" min="100" max="2000" step="100" style="width: 80px;">
          </div>
          <button id="extractRoadsBtn">Extract Roads</button>
          <button id="cancelAreaBtn">Cancel</button>
        `;

        // Add control to the map container
        document.querySelector(".map-container").appendChild(controlDiv);

        // Add size change handler
        const sizeInput = document.getElementById("areaSize");
        if (sizeInput) {
          sizeInput.onchange = () => {
            const newSize = parseInt(sizeInput.value);
            if (newSize >= 100 && newSize <= 2000) {
              const newBounds = getSquareBounds(e.latlng, newSize);
              selectedBounds = newBounds;
              areaRectangle.setBounds(newBounds);
              logger.info(`Area size updated to ${newSize}m x ${newSize}m`);
            }
          };
        }

        // Extract Roads button handler
        const extractBtn = document.getElementById("extractRoadsBtn");
        if (extractBtn) {
          extractBtn.onclick = async () => {
            logger.info("Starting road extraction process...");
            areaSelectMode = false;
            map.getContainer().style.cursor = "";
            map.fitBounds(selectedBounds);

            // Remove the control before taking screenshot
            controlDiv.style.display = "none";

            setTimeout(async () => {
              try {
                logger.info("Capturing map area screenshot...");
                const mapDiv = document.getElementById("map");
                const canvas = await html2canvas(mapDiv, {
                  useCORS: true,
                  backgroundColor: null,
                });

                // Get pixel coordinates for bounds
                const nw = map.latLngToContainerPoint(selectedBounds[0]);
                const se = map.latLngToContainerPoint(selectedBounds[1]);

                // Calculate crop dimensions
                const x = Math.min(nw.x, se.x);
                const y = Math.min(nw.y, se.y);
                const width = Math.abs(se.x - nw.x);
                const height = Math.abs(se.y - nw.y);

                // Crop the canvas
                const croppedCanvas = document.createElement("canvas");
                croppedCanvas.width = width;
                croppedCanvas.height = height;
                const ctx = croppedCanvas.getContext("2d");
                ctx.drawImage(canvas, x, y, width, height, 0, 0, width, height);

                const imageBase64 = croppedCanvas.toDataURL("image/png");

                // Show preview of cropped area
                areaRectangle
                  .bindPopup(
                    `<b>Processing Area</b><br>
          <div>
            <strong>Selected Area Image:</strong><br>
            <img src="${imageBase64}" style="width:100%;max-width:300px;"><br>
            <div style="text-align:center">Processing...</div>
          </div>`
                  )
                  .openPopup();

                logger.info("Sending image to server for road detection...");

                const response = await fetch(
                  API_CONFIG.getUrl("ROAD_DETECTION"),
                  {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ image_base64: imageBase64 }),
                  }
                );

                const body = await response.json().catch(() => ({}));

                if (!response.ok) {
                  const errorMsg =
                    body.error || `Server error (${response.status})`;
                  logger.error(`Road detection failed: ${errorMsg}`);
                  areaRectangle
                    .bindPopup(`<b>Error</b><br>${errorMsg}`)
                    .openPopup();
                  return;
                }

                logger.success("Road detection completed successfully");
                const probMask = body.probability_mask;
                areaRectangle
                  .bindPopup(
                    `<b>Road Detection Result</b><br>
            <div>
              <strong>Input Image:</strong><br>
              <img src="${imageBase64}" style="width:100%;max-width:300px;"><br>
              <strong>Road Mask:</strong><br>
              <img src="${probMask}" style="width:100%;max-width:300px;"><br>
              <button id="downloadInputBtn">Download Input</button>
              <button id="downloadMaskBtn">Download Mask</button>
            </div>`
                  )
                  .openPopup();

                setTimeout(() => {
                  // Download Input Image
                  const downloadInputBtn =
                    document.getElementById("downloadInputBtn");
                  if (downloadInputBtn) {
                    downloadInputBtn.onclick = () => {
                      const link = document.createElement("a");
                      link.href = imageBase64;
                      link.download = "road_input.png";
                      document.body.appendChild(link);
                      link.click();
                      document.body.removeChild(link);
                      logger.info("Input image downloaded");
                    };
                  }

                  // Download Mask Image
                  const downloadMaskBtn =
                    document.getElementById("downloadMaskBtn");
                  if (downloadMaskBtn) {
                    downloadMaskBtn.onclick = () => {
                      const link = document.createElement("a");
                      link.href = probMask;
                      link.download = "road_mask.png";
                      document.body.appendChild(link);
                      link.click();
                      document.body.removeChild(link);
                      logger.info("Road mask downloaded");
                    };
                  }
                }, 150);
              } catch (error) {
                logger.error(`Network error: ${error.message}`);
                areaRectangle
                  .bindPopup(`<b>Error</b><br>Network error: ${error.message}`)
                  .openPopup();
              }
            }, 1000);
          };
        }

        // Cancel button handler
        const cancelBtn = document.getElementById("cancelAreaBtn");
        if (cancelBtn) {
          cancelBtn.onclick = () => {
            map.removeLayer(areaRectangle);
            areaRectangle = null;
            areaSelectMode = false;
            map.getContainer().style.cursor = "";
            controlDiv.remove();
            logger.info("Area selection cancelled");
          };
        }
      });

      // Layer Switch Button Handlers
      document.getElementById("defaultLayerBtn").onclick = function () {
        if (!map.hasLayer(defaultLayer)) {
          map.addLayer(defaultLayer);
        }
        if (map.hasLayer(satelliteLayer)) {
          map.removeLayer(satelliteLayer);
        }
        this.classList.add("active");
        document.getElementById("satelliteLayerBtn").classList.remove("active");
      };

      document.getElementById("satelliteLayerBtn").onclick = function () {
        if (!map.hasLayer(satelliteLayer)) {
          map.addLayer(satelliteLayer);
        }
        if (map.hasLayer(defaultLayer)) {
          map.removeLayer(defaultLayer);
        }
        this.classList.add("active");
        document.getElementById("defaultLayerBtn").classList.remove("active");
      };

      // === Aircraft plotting ===
      // let aircraftLayer = L.layerGroup().addTo(map);
      let updateFlightsInterval;

      // Create plane icon once
      const planeIcon = L.icon({
        iconUrl: "../../../assets/airplane.png",
        iconSize: [32, 32],
        iconAnchor: [16, 16],
        popupAnchor: [0, -16],
      });

      async function updateFlights() {
        try {
          logger.info("Fetching aircraft data...");
          const res = await fetch(API_CONFIG.getUrl("FLIGHTS"));
          if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);

          const data = await res.json();

          // Only update if we're on the aircraft tab
          if (activeFeature === "aircraft") {
            featureLayers.aircraft.clearLayers(); // Clear the correct layer

            if (!data.states || !Array.isArray(data.states)) {
              logger.warning("No flight data available or invalid format");
              return;
            }

            const maxPlanes = 500;
            const planes = data.states.slice(0, maxPlanes);

            function createRotatedPlaneIcon(heading) {
              const iconHtml = `
          <div style="
            width: 32px; 
            height: 32px; 
            transform: rotate(${heading}deg);
            transform-origin: center;
            display: flex;
            align-items: center;
            justify-content: center;
          ">
            <img src="../../../assets/airplane.png" style="width: 32px; height: 32px;" alt="plane" />
          </div>
        `;

              return L.divIcon({
                html: iconHtml,
                iconSize: [32, 32],
                iconAnchor: [16, 16],
                popupAnchor: [0, -16],
                className: "custom-plane-icon",
              });
            }

            let validPlanesCount = 0;
            planes.forEach((state) => {
              const lat = state[6];
              const lon = state[5];
              const callsign = state[1]?.trim() || "Unknown";
              const altitude = Math.round((state[7] || 0) * 3.28084);
              const velocity = Math.round((state[9] || 0) * 2.236936);
              const heading = state[10];

              if (lat && lon && !isNaN(lat) && !isNaN(lon)) {
                if (heading !== null && !isNaN(heading)) {
                  const rotatedIcon = createRotatedPlaneIcon(heading);
                  const marker = L.marker([lat, lon], { icon: rotatedIcon });

                  marker.bindPopup(`
              <b>Flight: ${callsign}</b><br>
              Altitude: ${altitude} ft<br>
              lat: ${lat.toFixed(4)}¬∞, lon: ${lon.toFixed(4)}¬∞<br>
              Speed: ${velocity} mph<br>
              Heading: ${heading}¬∞
            `);

                  marker.addTo(featureLayers.aircraft); // Add to the correct layer
                  validPlanesCount++;
                }
              }
            });

            logger.success(`Updated ${validPlanesCount} aircraft positions`);
          }
        } catch (err) {
          logger.error(`Failed to fetch aircraft data: ${err.message}`);
        }
      }

      // Add text-to-speech toggle and clear logs buttons to the panel header
      const panelHeader = document.querySelector(".panel-header");

      // Text-to-speech toggle button
      const ttsBtn = document.createElement("button");
      ttsBtn.textContent = "üîä Voice";
      ttsBtn.className = "expand-btn";
      ttsBtn.style.marginRight = "8px";
      ttsBtn.setAttribute("data-enabled", "true");
      ttsBtn.onclick = () => {
        const isEnabled = ttsBtn.getAttribute("data-enabled") === "true";
        ttsBtn.setAttribute("data-enabled", (!isEnabled).toString());
        ttsBtn.textContent = isEnabled ? "üîá Voice" : "üîä Voice";
        logger.toggleSpeech();
        logger.info(`Text-to-speech ${isEnabled ? "disabled" : "enabled"}`);
      };

      // Clear logs button
      const clearLogsBtn = document.createElement("button");
      clearLogsBtn.textContent = "Clear";
      clearLogsBtn.className = "expand-btn";
      clearLogsBtn.style.marginRight = "8px";
      clearLogsBtn.onclick = () => {
        logger.clear();
        logger.info("Logs cleared");
      };

      panelHeader.insertBefore(
        ttsBtn,
        panelHeader.querySelector(".expand-btn")
      );
      panelHeader.insertBefore(
        clearLogsBtn,
        panelHeader.querySelector(".expand-btn")
      );
    </script>
  </body>
</html>
